$(document).ready(function()
{

	$(".close").css("display", "none");
	$(".close-help").css("display", "none");

	var isMenuOpen = false;
	var isHelpOpen = false;

	$('.menu_btn').click(function()
	{
		if (isMenuOpen === false)
		{
		//alert('je suis dans le bon cas')
			$("#menu").clearQueue().animate({
				left : '0'
			});

			$(".close").fadeIn(300);

			isMenuOpen = true;
		}
	});

	$('.close').click(function()
	{
		if (isMenuOpen === true)
		{
			$("#menu").clearQueue().animate({
				left : '-240px'
			});

			$(this).fadeOut(200);

			isMenuOpen = false;
		}
	});

	$("#menu").find('a').click(function()
	{
		if (isMenuOpen === true)
		{
			$("#menu").clearQueue().animate({
				left : '-240px'
			});

			$('.close').fadeOut(200);

			isMenuOpen = false;
		}
	});




	$('.help_btn').click(function()
	{
		if (isHelpOpen === false)
		{
		//alert('je suis dans le bon cas')
			$("#help").clearQueue().animate({
				right : '0'
			});

			$(".close-help").fadeIn(300);

			isHelpOpen = true;
		}
	});

	$('.close-help').click(function()
	{
		if (isHelpOpen === true)
		{
			$("#help").clearQueue().animate({
				right : '-240px'
			});

			$(this).fadeOut(200);

			isHelpOpen = false;
		}
	});

});

(function() {

    'use strict';

    angular.module('ruler', ['ngRoute', 'ui.bootstrap', 'ui.bootstrap.typeahead'])
            .config(function($routeProvider) {
                $routeProvider
                    .when('/', {
                        templateUrl: 'partials/home.html',
                        controller: 'persosCtrl',
                    })
                    .when('/list/:ltr?', {
                        templateUrl: 'partials/list.html',
                        controller: 'listCtrl',
                    })
                    .when('/about', {
                        templateUrl: 'partials/about.html',
                    })
                    .otherwise({
                        redirectTo: '/'
                    });
            });

}());

(function(){

  "use strict";

  angular.module('ruler')
        .controller('listCtrl', persosCtrl)
        .filter('selectByLtr', function(){
          return function(input, ltr){
            var out = [];

              angular.forEach(input, function(user){
                var lastLower = user.lastname.toLowerCase().substr(0,1);

                if(lastLower == ltr){
                  out.push(user);
                }
              });

            return out;
          };
        });

  function persosCtrl($scope, $http, $routeParams){

    $http.get("/json").
          success(function(data, status) {

            $scope.persos = data;
          });

    $scope.lettre = $routeParams.ltr || "a";
  }

}());

(function(){

  "use strict";

  angular.module('ruler')
        .controller('persosCtrl', persosCtrl)
        .directive('loading', ['$http', function ($http) {
            return {
              restrict: 'A',
              link: function (scope, element, attrs) {
                scope.isLoading = function () {
                  return $http.pendingRequests.length > 0;
                };
                scope.$watch(scope.isLoading, function (value) {
                  if (value) {
                    element.removeClass('ng-hide');
                  } else {
                    element.addClass('ng-hide');
                  }
                });
              }
            };
        }])
        .filter('selectById', function(){
          return function(input, id){

            var out = [];

              angular.forEach(input, function(user){
                if(id.includes(user.id)){
                  out.push(user);
                }
              });


            return out;
          };
        });

  function persosCtrl($scope, $http, $filter){

    $scope.customGender = true;

    if (sessionStorage.getItem("ssCompare") === null) {
      $scope.persoSelected = [];
    } else {
      $scope.persoSelected  = JSON.parse(sessionStorage.getItem("ssCompare"));
    }

    $http.get("/json").
          success(function(data, status) {

            $scope.persos = data;

          	// $scope.persos = data;
            if ($.inArray(9999, $scope.persoSelected) !== -1)
            {
              $scope.persos.push(JSON.parse(sessionStorage.getItem("ssCustom")));
            }

            $scope.tabAutoComplete = [];

            for (var i = 0; i < $scope.persos.length; i++) {

              if ($scope.persos[i] !== undefined) {
                $scope.tabAutoComplete[$scope.persos[i].id] = $scope.persos[i].firstname + " " + $scope.persos[i].lastname;
              }

            }

          });


    $scope.ngModelOptionsSelected = function(value) {
      if (arguments.length) {
        _selected = value;
      } else {
        return _selected;
      }
    };

    $scope.modelOptions = {
      debounce: {
        default: 500,
        blur: 250
      },
      getterSetter: true
    };

    $scope.addPerso = function(){

      var idArray = $scope.tabAutoComplete.indexOf($scope.selected);

      if (idArray !== -1 && $scope.persoSelected.indexOf(idArray) === -1) {
        $scope.persoSelected.push(idArray);
      }

      $scope.selected = "";

      sessionStorage.setItem("ssCompare",JSON.stringify($scope.persoSelected));

    };

    $scope.addCustomPerso = function(isValid){

      if (isValid) {

        var index = $scope.persos.findIndex(function(item, i){
          return item.id === 9999;
        });

        var size = 175;
        if (parseInt($scope.customSize) >= 80 && parseInt($scope.customSize) <= 225)
        {
            size = parseInt($scope.customSize);
        }


        var customAvatar = {
          "id": 9999,
          "firstname": "",
          "lastname": $scope.customFirstName,
          "gender": !$scope.customGender,
          "pictureUrl": "blank.png",
          "size": size
        };

        if (index !== -1)
        {
          $scope.persos.splice(index, 1);
        }

        $scope.persos.push(customAvatar);
        $scope.persoSelected.push(9999);

        $scope.customSize = "";
        $scope.customFirstName = "";
        $scope.customGender = true;

        sessionStorage.setItem("ssCompare",JSON.stringify($scope.persoSelected));
        sessionStorage.setItem("ssCustom",JSON.stringify(customAvatar));
      }

    };

    $scope.deletePerso = function(id){

      var index = $scope.persoSelected.indexOf(id);
      $scope.persoSelected.splice(index, 1);

      sessionStorage.setItem("ssCompare",JSON.stringify($scope.persoSelected));

    };

  }

}());

//# sourceMappingURL=app.min.js.map
